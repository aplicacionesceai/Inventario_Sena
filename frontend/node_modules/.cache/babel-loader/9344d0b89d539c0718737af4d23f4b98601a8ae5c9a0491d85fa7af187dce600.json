{"ast":null,"code":"import{createContext,useState,useEffect,useContext,useCallback}from'react';import api from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[authState,setAuthState]=useState({user:null,loading:true,error:null});// Mueve logout a useCallback para memoización\nconst logout=useCallback(()=>{localStorage.removeItem('authToken');localStorage.removeItem('userData');setAuthState({user:null,loading:false,error:null});},[]);const login=async credentials=>{try{setAuthState(prev=>({...prev,loading:true,error:null}));const response=await api.post('/auth/login/',credentials);localStorage.setItem('authToken',response.data.token);localStorage.setItem('userData',JSON.stringify(response.data.user));setAuthState({user:response.data.user,loading:false,error:null});return true;}catch(error){var _error$response,_error$response$data;setAuthState({user:null,loading:false,error:((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||\"Error al iniciar sesión\"});return false;}};// verifyAuth ahora usa useCallback y recibe logout como dependencia\nconst verifyAuth=useCallback(async()=>{const token=localStorage.getItem('authToken');if(!token){setAuthState(prev=>({...prev,loading:false}));return;}try{const response=await api.get('/auth/verify/');setAuthState({user:response.data.user,loading:false,error:null});}catch(error){logout();// Ahora está correctamente referenciado\n}},[logout]);useEffect(()=>{verifyAuth();},[verifyAuth]);// Solo depende de verifyAuth\nreturn/*#__PURE__*/_jsx(AuthContext.Provider,{value:{...authState,login,logout,isAuthenticated:!!authState.user},children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth debe usarse dentro de un AuthProvider');}return context;};","map":{"version":3,"names":["createContext","useState","useEffect","useContext","useCallback","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","authState","setAuthState","user","loading","error","logout","localStorage","removeItem","login","credentials","prev","response","post","setItem","data","token","JSON","stringify","_error$response","_error$response$data","verifyAuth","getItem","get","Provider","value","isAuthenticated","useAuth","context","Error"],"sources":["C:/Users/SENA/Documents/GitHub/Sena_Inventario/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import { createContext, useState, useEffect, useContext, useCallback } from 'react';\r\nimport api from '../services/api';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [authState, setAuthState] = useState({\r\n    user: null,\r\n    loading: true,\r\n    error: null\r\n  });\r\n\r\n  // Mueve logout a useCallback para memoización\r\n  const logout = useCallback(() => {\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    setAuthState({\r\n      user: null,\r\n      loading: false,\r\n      error: null\r\n    });\r\n  }, []);\r\n\r\n  const login = async (credentials) => {\r\n    try {\r\n      setAuthState(prev => ({ ...prev, loading: true, error: null }));\r\n      const response = await api.post('/auth/login/', credentials);\r\n      \r\n      localStorage.setItem('authToken', response.data.token);\r\n      localStorage.setItem('userData', JSON.stringify(response.data.user));\r\n      \r\n      setAuthState({\r\n        user: response.data.user,\r\n        loading: false,\r\n        error: null\r\n      });\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      setAuthState({\r\n        user: null,\r\n        loading: false,\r\n        error: error.response?.data?.error || \"Error al iniciar sesión\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // verifyAuth ahora usa useCallback y recibe logout como dependencia\r\n  const verifyAuth = useCallback(async () => {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    if (!token) {\r\n      setAuthState(prev => ({ ...prev, loading: false }));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await api.get('/auth/verify/');\r\n      setAuthState({\r\n        user: response.data.user,\r\n        loading: false,\r\n        error: null\r\n      });\r\n    } catch (error) {\r\n      logout(); // Ahora está correctamente referenciado\r\n    }\r\n  }, [logout]);\r\n\r\n  useEffect(() => {\r\n    verifyAuth();\r\n  }, [verifyAuth]); // Solo depende de verifyAuth\r\n\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      ...authState,\r\n      login,\r\n      logout,\r\n      isAuthenticated: !!authState.user\r\n    }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth debe usarse dentro de un AuthProvider');\r\n  }\r\n  return context;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}